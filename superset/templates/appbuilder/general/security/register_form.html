
{% import 'appbuilder/general/savvy_lib.html' as lib %}
{% block content %}



{% if form_action %}
    <form action="{{form_action}}" method="post" enctype="multipart/form-data">
{% else %}
    <form id="model_form" action="" method="post" enctype="multipart/form-data">
{% endif %}
    {{ form.hidden_tag() }}
    <div class="register-form" style="margin:auto; width:40%;">
        {% for field in form %}
            {% if field.name=='stay_login' %}
                <div class="input-group" style="display: block;">
                    {{ field(value="0") }}
                    <label for="stay_login">Stay signed in</label>
                </div>
            {% else %}
                <div class="input-group">
                    {{ field(size = 60, class = "form-control login-form", placeholder=field.label.text) }}
                    {% if field.name == 'password' %}
                        <span class="fa fa-hand-pointer-o" style="color: RGBA(218,211,56,0.5); z-index: 12;" hidden></span>
                    {% endif %}
                    {% if field.errors %}
                        <span class="fa fa-times-circle-o fa-1x" style="color: RGBA(184,16,56,0.5); z-index: 11;"></span>
                    {% endif %}
                    <span class="fa fa-check" style="color: #079493; z-index: 10;" hidden></span>
                </div>
                <a>&nbsp;</a>
            {% endif %}
        {% endfor %}
    </div>
    <div class="control-group">
        <div class="reg-footer">
            <div style="float: left">
                <div class="savvybi-alert alert-info caplock-alert" hidden>
                    You have your CAPS LOCK on. Is that what you want?
                </div>
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, m in messages %}
                            {% if category %}
                                <div class="savvybi-alert alert-{{ category }} flush-message">
                            {% else %}
                                <div class="savvybi-alert alert-info flush-message">
                            {% endif %}
                            {{ m }}
                            </div>
                        {% endfor %}
                    {% elif form.errors %}
                        {% for error in form.errors.items() %}
                          {% if loop.first %}
                            <div class="savvybi-alert alert-danger error-message">{{ error[1][0] }}</div>
                          {% endif %}
                        {% endfor %}
                    {% else %}

                    {% endif %}
                <div class="savvybi-alert alert-note" >
                    Make sure you save your password, make it secure!
                </div>
                <div class="savvybi-alert alert-success alert-ready" hidden>
                    All good let's do it!
                </div>

                {% endwith %}
            </div>
            <div style="float: right;">
                <input class="btn btn-primary btn-block form-submit" type="submit" value="{{_('Sign Up')}}">
            </div>
        </div>
    </div>
    </form>
    <script>
        $('.login-form').each(function(){
            if($(this).val() == '')
                $('input:submit').attr('disabled','disabled');
                $('input:submit').removeClass('btn-primary').addClass('btn-disabled');

            if($(this).attr('name') != 'csrf_token'){
                if ($(this).val() != '' && $(this).parent().find($('.fa-times-circle-o')).length==0){
                    alert("asdf")
                    $(this).siblings('span').hide();
                    $(this).siblings('.fa-check').show();
                }else{
                   $(this).siblings('.fa-check').hide();
                }
            }
        })

        $('#stay_login').on('click', function(){
            if($(this). prop("checked") == true){
                $(this).val(1);
            }else{
                $(this).val(0);
            }
        })

        $('.login-form').on('focusout', function(){
            if ($(this).val() != '') {
                $(this).siblings('span').hide();
                $(this).siblings('.fa-check').show();
            }
            else{
                $(this).siblings('.fa-check').hide();
            }

            let submit_flag = true;
            $('.login-form').each(function(){
                if ($(this).val() == '')
                    submit_flag = false
            })
            if(submit_flag == true) {
                $('input:submit').removeAttr('disabled');
                $('input:submit').removeClass('btn-disabled').addClass('btn-primary');
                $('.savvybi-alert').hide();
                $('.alert-ready').show();

            }
            else {
                $('input:submit').attr('disabled', 'disabled');
                $('input:submit').removeClass('btn-primary').addClass('btn-disabled');
                $('.savvybi-alert').hide();
                $('.error-message').show();
                $('.flush-message').show();
            }
        })

        let password = document.getElementsByName('password')[0]
        password.addEventListener("keyup", function(event) {
            // If "caps lock" is pressed, display the warning text
            if (event instanceof KeyboardEvent ) {
                if (event.getModifierState("CapsLock")) {

                    $(".savvybi-alert:not(.capslock-alert)").hide();
                    $(".caplock-alert").show();
                    $(this).siblings('span').hide();
                    $(this).siblings('.fa-hand-pointer-o').show();
                } else {
                    $(".savvybi-alert:not(.capslock-alert):not(.alert-ready)").show();
                    $(".caplock-alert").hide();
                    $(this).siblings('span').hide()
                }
            }
        });

    </script>
{% endblock %}


