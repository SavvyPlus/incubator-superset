<!DOCTYPE html>
<html class=" ">
    <head>
        <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
        <meta charset="utf-8" />

        {% block title %}
        <title>SavvyBI Admin</title>
        {% endblock %}

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta content="" name="description" />
        <meta content="" name="author" />

        <link rel="shortcut icon" href="{{ url_for('static', filename='assets/images/favicon.png') }}" type="image/x-icon" />    <!-- Favicon -->

        {% block css_import %}
        <!-- CORE CSS FRAMEWORK - START -->
        <link href="{{ url_for('static', filename='assets/savvybi/plugins/pace/pace-theme-flash.css') }}" rel="stylesheet" type="text/css" media="screen"/>
        <link href="{{ url_for('static', filename='assets/savvybi/plugins/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/plugins/bootstrap/css/bootstrap-theme.min.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/fonts/font-awesome/css/font-awesome.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/css/animate.min.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/plugins/perfect-scrollbar/perfect-scrollbar.css') }}" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
        <!-- CORE CSS FRAMEWORK - END -->

        <link href="{{ url_for('static', filename='assets/savvybi/plugins/jquery-ui/smoothness/jquery-ui.min.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/plugins/select2/select2.css') }}" rel="stylesheet" type="text/css"/>

        <!-- CORE CSS TEMPLATE - START -->
        <link href="{{ url_for('static', filename='assets/savvybi/css/savvybi.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/css/style.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ url_for('static', filename='assets/savvybi/css/responsive.css') }}" rel="stylesheet" type="text/css"/>
        <!-- CORE CSS TEMPLATE - END -->
        {% endblock %}
    </head>
    <!-- END HEAD -->

    <!-- BEGIN BODY -->
    <body>
        <!-- START TOPBAR -->
        {% block topbar %}
            <div class="admin-header">
                {% include 'savvy/navbar.html' %}
            </div>
        {% endblock %}
        <!-- END TOPBAR -->
        <!-- START CONTAINER -->
        <div class="page-container row-fluid" id="savvy-content">

            <!-- SIDEBAR - START -->
            {% block sidebar %}
                {% include 'savvy/sidebar.html' %}
            {% endblock %}
            <!--  SIDEBAR - END -->
            <!-- START CONTENT -->
            <section id="main-content">
                <section class="wrapper main-wrapper" style=''>
                {% block main_content %}
                {% endblock %}
                </section>
            </section>

            <div class="modal-section">
                {% block dialogs %}
                {% endblock %}
            </div>

            <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->
        <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->

        {% block js_import %}
            <!-- CORE JS FRAMEWORK - START -->
            <script src="{{ url_for('static', filename='assets/savvybi/js/jquery-1.11.2.min.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/js/jquery.easing.min.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/plugins/bootstrap/js/bootstrap.min.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/plugins/pace/pace.min.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/plugins/perfect-scrollbar/perfect-scrollbar.min.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/plugins/viewport/viewportchecker.js') }}" type="text/javascript"></script>
            <!-- CORE JS FRAMEWORK - END -->

            <script src="{{ url_for('static', filename='assets/savvybi/plugins/jquery-ui/smoothness/jquery-ui.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/plugins/select2/select2.js') }}" type="text/javascript"></script>

            <!-- CORE TEMPLATE JS - START -->
            <script src="{{ url_for('static', filename='assets/savvybi/js/scripts.js') }}" type="text/javascript"></script>
            <!-- END CORE TEMPLATE JS - END -->

            <!-- Sidebar Graph - START -->
            <script src="{{ url_for('static', filename='assets/savvybi/plugins/sparkline-chart/jquery.sparkline.min.js') }}" type="text/javascript"></script>
            <script src="{{ url_for('static', filename='assets/savvybi/js/chart-sparkline.js') }}" type="text/javascript"></script>
            <!-- Sidebar Graph - END -->

            <script>
                $.fn.modal.Constructor.prototype.enforceFocus = function() {};
                $("#group-list").select2({
                    dropdownParent: $("#invite-users-modal")
                });

                $("#invite-index-modal .modal-body .panel").hover(function(){

                    $(this).find(".arrow-btn").addClass('in');
                });

                $("#invite-index-modal .modal-body .panel").mouseleave(function(){

                    $(this).find(".arrow-btn").removeClass('in');
                });

                // When click arrow button of user type panel in first page of invitatio dialog
                $("#invite-index-modal a[data-toggle='modal']").on('click', function(){
                    $("#invite-users-modal #user_type").val($(this).attr('data-value'));
                });

                // When add new user field to invite one more user in invite-users-modal
                $("#add-user-field-btn").on('click', function(){
                    var new_field_content = `<div class='col-lg-12 col-md-12 col-sm-12 col-xs-12 sort_panel'>\n
                            <section class='box'>
                                <div class='panel_header'>
                                    <div class='col-sm-5 col-sm-offset-1'>
                                        <input type='email' name='user_email'>
                                    </div>
                                    <div class='col-sm-5'>
                                        <input type='text' name='user_name'>
                                    </div>
                                    <div class='actions panel_actions pull-right col-sm-1'>
                                        <i class='box_close fa fa-times'></i>
                                    </div>
                                </div>
                            </section>
                        </div>`;
                    $("#user-invite-list-field").append(new_field_content);
                })

                // Add bulk email addresses to invite users list
                $("#bulk-user-email-add-btn").on('click', function(){
                    var emails = $("#bulk-email-input").val().split(',');
                    $("#user-invite-list-field").html('');

                    emails.forEach(function(email, index){
                        var dummy_fullname = email.split('@')[0].replace('.', ' ');
                        var new_field_content = `<div class='col-lg-12 col-md-12 col-sm-12 col-xs-12 sort_panel'>\n
                            <section class='box'>
                                <div class='panel_header'>
                                    <div class='col-sm-5 col-sm-offset-1'>
                                        <input type='email' value='${email}' name='user_email'>
                                    </div>
                                    <div class='col-sm-5'>
                                        <input type='text' value='${dummy_fullname}' name='user_name'>
                                    </div>
                                    <div class='actions panel_actions pull-right col-sm-1'>
                                        <i class='box_close fa fa-times'></i>
                                    </div>
                                </div>
                            </section>
                        </div>`;
                        $("#user-invite-list-field").append(new_field_content);
                    });

                    var email_counts = emails.length;
                    $("#invite-users-modal .modal-body blockquote").removeClass('hide')
                    $("#invite-users-modal .modal-body blockquote .alert-content span").html(email_counts);
                });

                $("#invite-users-modal #send-invite-btn").click(function(event){
                    event.preventDefault();
                    $.ajax({
                        url: $('#invite-users-modal form').attr('action'),
                        data: $('#invite-users-modal form').serialize(),
                        type: 'POST',
                        success: function(response){
                            $('#invite-done-modal .loading-content').addClass('hide');
                            $('#invite-done-modal .modal-content').removeClass('hide');
                            response = JSON.parse(response);
                            console.log(response);
                            console.log(response.status);

                            if(response.status == 'success'){
                                var invited_users = response.users;
                                $('#invite-done-modal .invited-user-count').text(invited_users.length+" Member");
                                for(var i = 0; i < invited_users.length; i++)
                                {
                                    var invited_user_tr = `
                                                        <tr>
                                                            <td>${invited_users[i].email}</td>
                                                            <td>${invited_users[i].name}</td>
                                                        </tr>`;
                                    $('#invite-done-modal .modal-content table tbody').append(invited_user_tr);
                                }

                            }else if(response.status == 'failed'){

                            }
                        },
                        error: function (error){

                        }
                    })
                });

                $('.modal').on('shown.bs.modal', function () {
                    $('body').addClass('modal-open');
                    // BS adds some padding-right to acomodate the scrollbar at right
                    $('body').removeAttr('style');
                })
                $(".modal [data-dismiss='modal']").click(function(event){
                    event.preventDefault();
                    if($(this).attr('data-toggle')!=null){
                        var modal_id = $(this).attr('href');
                        alert($(modal_id).attr('class'));
                        $(modal_id).modal('hide');
                        setTimeout(function(){
                            $(this).closest(".modal").removeClass('in').modal('hide');
                        }, 3000);
                    }

                });
                $('.modal').on('hidden.bs.modal', function () {
                    $(this).find('input').val('');
                    $(this).find('textarea').val('');
                })
            </script>
        {% endblock %}
    </body>
</html>



